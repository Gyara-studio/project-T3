[gd_scene load_steps=3 format=2]

[sub_resource type="GDScript" id=1]
script/source = "extends Node2D

const width: int = 360
const cap: int = width / 3
var history: Array = []
var cur: int = 0
var now: int = g.Piece.O

func _ready():
	# set up po
	var slotPck = preload(\"res://scene/Slot.tscn\")
	for i in 3:
		for j in 3:
			var po: String = \"%d%d\" % [i, j]
			var slot = slotPck.instance()
			slot.set_name(po)
			slot.po = po
			slot.set_position(Vector2(i*cap, j*cap))
			slot.connect(\"slot_click\", self, \"move\")
			add_child(slot)

func takeback():
	var last = history.pop_back()
	if last == null:
		return
	var po: String = last[0]
	get_node(po).clear()
	flip_now()
	if cur > 0:
		cur -= 1
		var back: Array = history[cur]
		if back[1] == g.Piece.X:
			get_node(back[0]).set_x()
		else:
			get_node(back[0]).set_o()


func move(po: String):
	#if now != g.play_on:
	#	return

	var piece: int = now
	var group := [po, piece]
	if piece == g.Piece.X:
		get_node(po).set_x()
	else:
		get_node(po).set_o()
	history.push_back(group)
	if len(history) >= 7:
		# do something with history[cur]
		var deal: Array = history[cur]
		get_node(deal[0]).clear()
		cur += 1
	flip_now()

func flip_now():
	if now == g.Piece.O:
		now = g.Piece.X
	else:
		now = g.Piece.O

const win_cond := []
func check_result():
	pass
"

[sub_resource type="GDScript" id=2]
script/source = "extends CanvasModulate

var width = 360
var cap = width / 3

func _ready():
	pass

func _draw():
	for i in 4:
		draw_line(Vector2(cap*i, 0), Vector2(cap*i, width), Color(230, 230, 230), 1)
	for i in 4:
		draw_line(Vector2(0, cap*i), Vector2(width, cap*i), Color(230, 230, 230), 1)
"

[node name="Board" type="Node2D"]
script = SubResource( 1 )

[node name="grid" type="CanvasModulate" parent="."]
script = SubResource( 2 )
